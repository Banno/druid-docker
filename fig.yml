zookeeper:
  image: jplock/zookeeper:3.4.6
  ports:
    - "2181:2181"

postgres:
  build: ./postgres
  ports:
    - "5432:5432"

druidbroker1:
  image: banno/druid-broker:latest
  links:
    - zookeeper
  ports:
    - "8082:8082"
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8082
    druid_zk_service_host: 192.168.59.103:2181
    druid_processing_buffer_sizeBytes: 52428800 #50 * 1024 * 1024

druidbroker2:
  image: banno/druid-broker:latest
  links:
    - zookeeper
  ports:
    - "8182:8182"
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8182
    druid_zk_service_host: 192.168.59.103:2181
    druid_processing_buffer_sizeBytes: 52428800 #50 * 1024 * 1024

druidcoordinator1:
  image: banno/druid-coordinator:latest
  links:
    - zookeeper
    - postgres
  ports:
    - "8081:8081"
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8081
    druid_zk_service_host: 192.168.59.103:2181
    druid_metadata_storage_type: postgresql
    druid_metadata_storage_connector_connectURI: jdbc:postgresql://192.168.59.103:5432/druid
    druid_metadata_storage_connector_user: druid
    druid_metadata_storage_connector_password: diurd
    druid_coordinator_load_timeout: PT30S
    druid_coordinator_startDelay: PT5S

druidcoordinator2:
  image: banno/druid-coordinator:latest
  links:
    - zookeeper
    - postgres
  ports:
    - "8181:8181"
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8181
    druid_zk_service_host: 192.168.59.103:2181
    druid_metadata_storage_type: postgresql
    druid_metadata_storage_connector_connectURI: jdbc:postgresql://192.168.59.103:5432/druid
    druid_metadata_storage_connector_user: druid
    druid_metadata_storage_connector_password: diurd
    druid_coordinator_load_timeout: PT30S
    druid_coordinator_startDelay: PT5S

druidhistorical1:
  image: banno/druid-historical:latest
  links:
    - zookeeper
  ports:
    - "8083:8083"
  volumes:
    - /mnt/sda1/druid:/tmp/druid/localStorage
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8083
    druid_zk_service_host: 192.168.59.103:2181
    druid_segmentCache_locations: "[{\"path\":\"/var/tmp/druid/indexCache\",\"maxSize\":5000000000}]"
    druid_processing_buffer_sizeBytes: 52428800 #50 * 1024 * 1024
    druid_server_maxSize: 5000000000

druidhistorical2:
  image: banno/druid-historical:latest
  links:
    - zookeeper
  ports:
    - "8183:8183"
  volumes:
    - /mnt/sda1/druid:/tmp/druid/localStorage
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8183
    druid_zk_service_host: 192.168.59.103:2181
    druid_segmentCache_locations: "[{\"path\":\"/var/tmp/druid/indexCache\",\"maxSize\":5000000000}]"
    druid_processing_buffer_sizeBytes: 52428800 #50 * 1024 * 1024
    druid_server_maxSize: 5000000000

druidoverlord1:
  image: banno/druid-overlord:latest
  links:
    - zookeeper
    - postgres
  ports:
    - "8085:8085"
    - "8100:8100"
    - "8101:8101"
    - "8102:8102"
    - "8103:8103"
    - "8104:8104"
    - "8105:8105"
    - "8106:8106"
    - "8107:8107"
    - "8108:8108"
    - "8109:8109"
  volumes:
    - /mnt/sda1/druid:/tmp/druid/localStorage
  environment:
    DRUID_JAVA_OPTIONS: -Xmx512M
    druid_host: 192.168.59.103
    druid_port: 8085
    druid_zk_service_host: 192.168.59.103:2181
    druid_metadata_storage_type: postgresql
    druid_metadata_storage_connector_connectURI: jdbc:postgresql://192.168.59.103:5432/druid
    druid_metadata_storage_connector_user: druid
    druid_metadata_storage_connector_password: diurd
    druid_indexer_runner_type: local
    druid_indexer_storage_type: metadata
    druid_indexer_queue_startDelay: PT0M
    druid_indexer_runner_javaOpts: -server -Xmx256m
    druid_indexer_runner_startPort: 8100
    druid_indexer_fork_property_druid_processing_numThreads: 1
    druid_indexer_fork_property_druid_computation_buffer_size: 100000000
    druid_service: overlord
    druid_processing_buffer_sizeBytes: 26214400 #25 * 1024 * 1024

druid:
  image: ubuntu:14.04
  command: echo "Druid rules"
  links:
    - druidbroker1
    # - druidbroker2
    - druidcoordinator1
    # - druidcoordinator2
    - druidhistorical1
    - druidhistorical2
    - druidoverlord1

mesosmaster:
  image: registry.banno-internal.com/mesos-master:latest
  hostname: boot2docker
  ports:
    - "5050:5050"
  environment:
    MESOS_ZK: zk://192.168.59.103:2181/mesos
    MESOS_LOG_DIR: /var/log
    MESOS_WORK_DIR: /mesos
    MESOS_QUORUM: 1
    MESOS_CLUSTER: development
    MESOS_HOSTNAME: boot2docker
  links:
    - zookeeper

mesosslave1:
  image: registry.banno-internal.com/mesos-slave:latest
  hostname: boot2docker
  ports:
    - "5151:5151"
  environment:
    MESOS_CONTAINERIZERS: docker
    MESOS_DOCKER_STOP_TIMEOUT: 30secs
    MESOS_LOG_DIR: /var/log
    MESOS_MASTER: zk://192.168.59.103:2181/mesos
    MESOS_WORK_DIR: /mesos
    MESOS_PORT: "5151"
    MESOS_HOSTNAME: boot2docker
    DOCKER_CERT_PATH:
    DOCKER_HOST:
    DOCKER_TLS_VERIFY:
  volumes:
    - /sys:/sys
    - /Users:/Users
  links:
    - zookeeper

# mesosslave2:
#   image: registry.banno-internal.com/mesos-slave:latest
#   dns: 172.17.42.1
#   hostname: mesosslave2.dev.banno.com
#   ports:
#     - "5152:5152"
#   environment:
#     MESOS_CONTAINERIZERS: docker
#     MESOS_DOCKER_STOP_TIMEOUT: 30secs
#     MESOS_LOG_DIR: /var/log
#     MESOS_MASTER: zk://192.168.59.103:2181/mesos
#     MESOS_WORK_DIR: /mesos
#     MESOS_PORT: "5152"
#     MESOS_HOSTNAME: mesosslave2.dev.banno.com
#     DOCKER_CERT_PATH:
#     DOCKER_HOST:
#     DOCKER_TLS_VERIFY:
#   volumes:
#     - /sys:/sys
#     - /Users:/Users
#   links:
#     - dns
#     - zookeeper

marathon:
  image: mesosphere/marathon:v0.8.0
  ports:
    - "8080:8080"
  command: --master zk://192.168.59.103:2181/mesos --zk zk://192.168.59.103:2181/marathon
  links:
    - zookeeper
    - mesosmaster
    - mesosslave1
    # - mesosslave2
    - postgres
